<!DOCTYPE html>
<html lang="th">

<head>
        <meta charset="utf-8">
        <title>Sidebar with Graphs</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <link href="https://fonts.googleapis.com/css?family=Kanit:400,700&display=swap" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
        <style>
                body {
                        margin: 0;
                        padding: 0;
                        height: 100vh;
                        background-color: #f0f0f0;
                        font-family: 'Kanit', sans-serif;
                        overflow: hidden;
                        /* Prevent scrolling */
                }

                /* Sidebar styles */
                .sidebar {
                        height: 100%;
                        width: 0;
                        position: fixed;
                        z-index: 2000;
                        top: 0;
                        right: 0;
                        background-color: #f5f5f5;
                        overflow-x: hidden;
                        transition: 0.5s;
                        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
                        padding-left: 10px;
                        padding-right: 10px;
                        box-sizing: border-box;
                }

                /* The content wrapper for the sidebar to provide spacing */
                .sidebar-content {
                        padding-top: 60px;
                }

                .sidebar .closebtn {
                        position: absolute;
                        top: 0;
                        left: 25px;
                        font-size: 36px;
                        color: #333;
                        text-decoration: none;
                }

                /* Open button styles */
                #open-btn-container {
                        position: fixed;
                        top: 50%;
                        right: 0;
                        z-index: 1000;
                        transform: translateY(-50%);
                }

                .openbtn {
                        background-color: #333;
                        border: none;
                        cursor: pointer;
                        padding: 0;
                        width: 40px;
                        height: 90px;
                        border-radius: 5px 0 0 5px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                }

                .openbtn:hover {
                        background-color: #555;
                }

                .hamburger-icon {
                        width: 25px;
                        height: 20px;
                        display: flex;
                        flex-direction: column;
                        justify-content: space-between;
                }

                .hamburger-icon span {
                        display: block;
                        width: 100%;
                        height: 3px;
                        background-color: #eee;
                        border-radius: 2px;
                }

                /* Graph container styles */
                #bar-chart-container,
                #pie-chart-container {
                        width: 100%;
                        height: 300px;
                        margin: 10px auto;
                }
        </style>
</head>

<body>

        <div id="mySidebar" class="sidebar">
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
                <div class="sidebar-content">
                        <h2 style="text-align: center;">ข้อมูลการจำแนกด้วยโมเดล</h2>
                        <div id="bar-chart-container"></div>
                        <div id="pie-chart-container"></div>
                </div>
        </div>

        <div id="open-btn-container">
                <button class="openbtn" onclick="openNav()">
                        <div class="hamburger-icon">
                                <span></span>
                                <span></span>
                                <span></span>
                        </div>
                </button>
        </div>

        <script>
                // JavaScript for the sidebar
                function openNav() {
                        document.getElementById("mySidebar").style.width = "400px";
                        setTimeout(() => {
                                renderCharts();
                        }, 600);
                }

                function closeNav() {
                        document.getElementById("mySidebar").style.width = "0";
                }

                // This function will render both charts
                function renderCharts() {
                        // --- Bar Chart ---
                        const barChart = echarts.init(document.getElementById('bar-chart-container'));
                        const barOption = {
                                title: { text: `ข้อมูลช่วงปีของภาพที่ได้จาก Google Street View`, left: 'center', textStyle: { fontSize: 14 } },
                                tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
                                grid: { left: '5%', right: '5%', bottom: '5%', containLabel: true },
                                xAxis: [{ type: 'category', data: ['2011', '2013', '2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024', '2025'], axisLabel: { rotate: 45 } }],
                                yAxis: [{ type: 'value' }],
                                series: [{ name: 'จำนวนภาพ', type: 'bar', barWidth: '50%', data: [81, 16, 667, 41, 115, 130, 419, 278, 1593, 1800, 2116, 51, 21267, 120] }]
                        };
                        barChart.setOption(barOption);

                        // --- Pie Chart ---
                        const pieChart = echarts.init(document.getElementById('pie-chart-container'));
                        const DATA_FILE = 'label_and_pollution.geojson';
                        const nameMap = {
                                'non_canyon': 'Non canyon', 'on_viaduct': 'On viaduct', 'under_viaduct': 'Under viaduct', '0_hw_1': '0<H/W<1', '1_hw_2': '1<H/W<2', '2_hw_4': '2<H/W<4', 'hw_4': 'H/W>4'
                        };
                        const desiredOrder = [
                                'Non canyon', 'On viaduct', 'Under viaduct', '0<H/W<1', '1<H/W<2', '2<H/W<4', 'H/W>4'
                        ];

                        async function loadDataAndRenderPie() {
                                try {
                                        const response = await fetch(DATA_FILE);
                                        const geojson = await response.json();
                                        const counts = {};
                                        geojson.features.forEach(f => {
                                                const rawLabel = f.properties.label;
                                                const readable = nameMap[rawLabel] || rawLabel;
                                                counts[readable] = (counts[readable] || 0) + 1;
                                        });
                                        const chartData = Object.keys(counts).map(label => ({
                                                value: counts[label],
                                                name: label
                                        }));
                                        const sortedChartData = desiredOrder.map(name => chartData.find(item => item.name === name)).filter(item => item !== undefined);
                                        const pieOption = {
                                                title: { text: `จำนวนของหุบเมืองแต่ละประเภท`, left: 'center', textStyle: { fontSize: 14 } },
                                                tooltip: { trigger: 'item', formatter: '{b}<br/>จำนวน: {c} ({d}%)' },
                                                legend: { orient: 'vertical', left: '65%', top: 'middle', itemGap: 8, itemWidth: 12, itemHeight: 12, textStyle: { fontSize: 10 }, data: desiredOrder },
                                                series: [{
                                                        name: 'จำนวนหุบเมือง',
                                                        type: 'pie',
                                                        radius: ['40%', '70%'],
                                                        center: ['35%', '50%'],
                                                        avoidLabelOverlap: false,
                                                        itemStyle: { borderRadius: 10, borderColor: '#fff', borderWidth: 2 },
                                                        label: { show: false, position: 'center' },
                                                        emphasis: { label: { show: true, fontSize: 16, fontWeight: 'bold', formatter: '{b}\n{d}%' } },
                                                        labelLine: { show: false },
                                                        data: sortedChartData
                                                }]
                                        };
                                        pieChart.setOption(pieOption);
                                        pieChart.resize(); // Adjust size after data is loaded
                                } catch (error) {
                                        console.error("Error loading pie data:", error);
                                }
                        }
                        loadDataAndRenderPie();
                        barChart.resize();
                }
        </script>
</body>

</html>